function initFormCalendars(a){var t=a.find(".s3wm-datepicker-calendar"),e=a.find(".s3wm-datepicker-calendar_interval");if(!t.length&&!e.length){var n="ru"!==$("html").attr("lang")?"en":"ru";a.find(".init-calendar").each((function(){new tcal({controlname:this.id,place:this.parentNode,lang:n})})),a.find(".init-calendar-interval").each((function(){for(var a=0;a<2;++a){var t=f_getElement(this.id+"["+a+"]");new tcal({controlname:t.id,place:t.parentNode,lang:n,intervalpair:[this.id+"[0]",this.id+"[1]"],intervalupdatecont:this.id})}}))}t.length&&$.datepicker&&t.each((function(){var a=$(this);if(a.hasClass("hasDatepicker"))return!1;a.datepicker({changeMonth:!0,changeYear:!0})})),e.length&&$.datepicker&&e.each((function(){var a=$(this);if(a.hasClass("calendar-init"))return!1;a.addClass("calendar-init");var t=a.closest(".form-calendar_interval,.form_calendar_interval").find('[type="text"]');t.eq(0).datepicker({changeMonth:!0,changeYear:!0,onClose:function(a){t.eq(1).datepicker("option","minDate",a)}}),t.eq(1).datepicker({changeMonth:!0,changeYear:!0,onClose:function(e){t.eq(0).datepicker("option","maxDate",e),a.val(t.eq(0).val()+" - "+t.eq(1).val())}})}))}function fixFormId(a){(match=a.data("api-url").match(/form_id[^=]?=(\d+)/))&&null!=match&&void 0!==typeof match[1]&&a.find('[name="form_id"]').val(match[1])}var s3From={init:function(){this.initForms()},initForms:function(parent,callback,from_response){var self=this;parent||(parent=document),$(parent)[0]!==document&&$(parent).is("[data-api-url][data-api-type=form]")||(parent=$(parent).find("[data-api-url][data-api-type=form]")),callback||(callback="function"==typeof parent.data("callback")?parent.data("callback"):eval(parent.data("callback"))),$(parent).each((function(){var $container=$(this),$form=$container.is("form")?$container:$container.find("form");function res(response){if(response.result.success&&response.result.redirect_url)document.location=response.result.redirect_url;else if(response.result&&response.result.html){var uploaders_inits="",scripts=response.result.html.match(/<script[^>]*>[^<]*newSWFU[^<]*<\/script>/gm);if(scripts)for(var i=0;i<scripts.length;i++)uploaders_inits+=scripts[i].replace(/<script[^>]*>([^<]+)<\/script>/,"$1");var $replacement=$(response.result.html.replace(/[\r\n]/g,"").replace(/<script[^>]*>.*?<\/script>/g,""));$($replacement).is("[data-api-url][data-api-type=form]")||($replacement=$($replacement).find("[data-api-url][data-api-type=form]")),$container.replaceWith($replacement),$container=$replacement,response.result&&response.result.success&&"undefined"!=typeof lpc_template&&$container.closest(".lpc-wrap").find("[class$=__title-wrap]").remove();var $captcha=$container.find("input[name=_cn]");$captcha.length&&$.getScript("http://captcha.oml.ru/static/captcha.js?2",(function(){var a=$container.find("[id^=s3_captcha_cn]");mgCaptcha.draw("/my/s3/captcha/get.php",a.length?a.get(0):null)}));var $uploads=$container.find('input[type="hidden"][id^="hidUploadField"]');function inituploaders(){uploaders_inits&&eval(uploaders_inits)}$uploads.length&&("function"!=typeof window.newSWFU?$.getScript("/shared/s3/plupload/plupload.all.pack.js",(function(){inituploaders()})):inituploaders()),self.initForms($container,callback,!0),"function"==typeof callback&&callback()}}fixFormId($container),$container.data("s3form_inited")||($form.length?$form.submit((function(){return $.post($container.data("api-url"),$form.serialize(),res),!1})):from_response||$.getJSON($container.data("api-url"),null,res),initFormCalendars($form),$container.data("s3form_inited",!0))}))}},s3PopupForm={init:function(){this.initPopupForms()},initPopupForms:function(parent,callback){parent||(parent=document),$(parent)[0]!==document&&$(parent).is("[data-api-url][data-api-type=popup-form]")||(parent=$(parent).find("[data-api-url][data-api-type=popup-form]")),parent.data("api-url")&&(fixFormId(parent),parent=parent.filter((function(){return!$(this).data("s3form_inited")})),callback||(callback="function"==typeof parent.data("callback")?parent.data("callback"):eval(parent.data("callback"))),parent.data("s3form_inited",!0).click((function(a){var t=$(this);return myo.show?myo.show({html:'<div data-api-url="'+t.data("api-url")+'" data-api-type="form"></div>',clas:$(this).data("wr-class"),afterOpen:function(){var a=this;a.loadDiv.show(),s3From.initForms(a.bodyDiv.find(">div[data-api-type]"),(function(){a.loadDiv.hide(),"function"==typeof callback&&callback()}))}}):myo.open&&myo.open({html:'<div data-api-url="'+t.data("api-url")+'" data-api-type="form"></div>',clas:$(this).data("wr-class"),afterOpen:function(){var a=this;a.loadDiv.show(),s3From.initForms(a.bodyDiv.find(">div[data-api-type]"),(function(){a.loadDiv.hide(),"function"==typeof callback&&callback()}))}}),a.preventDefault(),!1})))}};$((function(){s3PopupForm.init(),s3From.init()}));